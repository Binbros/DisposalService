version: "3.7"
services:
  rabbitmq: 
    image: rabbitmq:3-management-alpine
    container_name: rabbitmq
    volumes:
      - ./.docker/rabbitmq/etc/:/etc/rabbitmq/
      - ./.docker/rabbitmq/data/:/var/lib/rabbitmq/
      - ./.docker/rabbitmq/logs/:/var/log/rabbitmq/
    environment:
        RABBITMQ_ERLANG_COOKIE: ${RABBITMQ_ERLANG_COOKIE}
        RABBITMQ_DEFAULT_USER: ${RABBITMQ_DEFAULT_USER}
        RABBITMQ_DEFAULT_PASS: ${RABBITMQ_DEFAULT_PASS}
    ports:
        - 5672:5672
        - 15672:15672
  redis:
    build:
      context: "./services/redis-image"
  # disposal:
  #   build:
  #     context: "./services/disposal"
  #   environment:
  #     - REDIS_HOST=redis
  #     - REDIS_PORT=6379
  #     - LOGTOKEN=e9adc299-0cd0-477c-9fd3-51d74e91c36a
  #     - NODE_ENV=production
  #   volumes:
  #     - /disposal/node_modules
  #     - ./services/disposal:/disposal
  #   ports:
  #     - "3000:3000"

  mongo:
    image: mongo
    healthcheck:
      test: echo 'db.runCommand("ping").ok' | mongo localhost:27017/test --quiet

  user:
    build: 
      context: "./services/user"
      target: dev
    environment: 
      - NODE_ENV=production
      - MONGO_URI
    volumes: 
      - ./services/user:/user
    ports: 
      - "8000:8000"
  email:
    build: 
      context: "./services/email"
    volumes: 
      - ./services/email:/email